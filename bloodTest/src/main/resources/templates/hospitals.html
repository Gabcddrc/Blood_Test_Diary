<!DOCTYPE html>
<html>

<head>
  <!-- Mobile SideNav Icon DropDown -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
  <link rel="stylesheet" href="css/main.css">
  <script defer src="https://use.fontawesome.com/releases/v5.0.9/js/all.js" integrity="sha384-8iPTk2s/jMVj81dnzb/iFR2sdA7u06vHJyyLlAd4snFpCl/SnyUjRrbdJsw1pGIl"
    crossorigin="anonymous"></script>
  <title>Blood Test Diary</title>

  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
</head>

<body>
  <!-- Menu Bar -->
  <div th:replace="component/navbar.html"></div>

  <div th:replace="component/mnav.html"></div>

  <!-- Patient Table -->
  <section class="section section-login light-blue lighten-5 center">
    <div class="row">
      <div class="col s6">
        <input placeholder="Search Hospital By name" id="name" onkeyup="searchHospitalFunction()" type="text">
      </div>
      <div class="col s12">
        <div class="card blue lighten-3">
          <table class="highlight" id="hospitalTable">
            <thead>
              <tr>
                <th><a class="btn-floating btn waves-effect waves-light blue"><i class="medium material-icons">arrow_drop_down</i></a>Name</th>
                <th><a class="btn-floating btn waves-effect waves-light blue"><i class="medium material-icons">arrow_drop_down</i></a>Address</th>
                <th><a class="btn-floating btn waves-effect waves-light blue"><i class="medium material-icons">arrow_drop_down</i></a>Email</th>
                <th><a class="btn-floating btn waves-effect waves-light blue"><i class="medium material-icons">arrow_drop_down</i></a>Phone</th>
            </thead>
            <tbody>
              <tr>
              <tr th:each="hospital:${hospitals}">
                <td th:text="${hospital.name}"></td>
                <td th:text="${hospital.address}"></td>
                <td th:text="${hospital.email}"></td>
                <td th:text="${hospital.phone}"></td>
                <td><button th:data-address="${hospital.address}" onclick="buttonHelper(this.getAttribute('data-address'))">Show
                    on Google Map</button></td>
                <!--Point: How to pass ${hospital.address} as a parameter for buttonHelper -->
              </tr>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="map" style="width: 400px; height: 300px;"></div>

  </section>

  <div th:replace="component/footer.html"></div>

  <div id="map"></div>
  <!-- Google Map API-->
  <script th:inline="javascript">
    var map;

    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: {
          lat: 51.508530,
          lng: -0.076132
        }, //London
        zoom: 10
      });
      //var geocoder = new google.maps.Geocoder();
      //document.getElementById('showHospital').addEventListener('click',function(){
      //  geocodeAddress(geocoder,map);
      //});
    }

    function buttonHelper(address) {
      geocodeAddress(map, address);
    }

    function geocodeAddress(resultsMap, address) {
      var geocoder = new google.maps.Geocoder(); //Test
      geocoder.geocode({
        'address': address
      }, function (results, status) {
        if (status === 'OK') {
          resultsMap.setCenter(results[0].geometry.location);
          var marker = new google.maps.Marker({
            map: resultsMap,
            position: results[0].geometry.location
          });
          resultsMap.setZoom(15);
        } else {
          alert('Not successful for the following reason: ' + status);
        }
      });
    }
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBh9zKIFA-ZFU8dzYetT3xPUugxj99Kauw&callback=initMap"
    async defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>

  <script>
    const sideNav = document.querySelector('.sidenav');
    M.Sidenav.init(sideNav, {});
  </script>

  <script>
    function searchHospitalFunction() {
      let input, filter, table, tr, td, i;
      input = document.getElementById("name");
      filter = input.value.toUpperCase();
      table = document.getElementById("hospitalTable");
      tr = table.getElementsByTagName("tr");
      for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td")[0];
        if (td) {
          if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
            tr[i].style.display = "";
          } else {
            tr[i].style.display = "none";
          }
        }
      }
    }
  </script>

</body>

</html>